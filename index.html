<!DOCTYPE html>
<html>
  <head>
    <title>Fox 91.4 Desktop Client</title>   
    
    <link rel="stylesheet" href="libs/animate/animate.css">
    <link rel="stylesheet" type="text/css" href="libs/fox-desktop/site.css">
    <link rel="stylesheet" type="text/css" href="node_modules/toastr/build/toastr.css">
  </head>
  <body class="body_background">
    <div class="heading">
        <h1 id="heading" align="center">Fox 91.4</h1>
    </div>
    <audio id="audio">
        <source src="" type="audio/mpeg" />
    </audio>
        
    <div id="container_button">
        <div id="hole">
            <div id="button">
                <div id="triangle"></div>
                <div id="lighter_triangle"></div>
                <div id="darker_triangle"></div>
            </div>
        </div>
    </div> 
       
        
    <script type="application/javascript">
        var $ = require('jquery');
        var jQuery = $;
        
        $(document).ready(function () {            
            
            var toastr = require('toastr');    
            toastr.options.preventDuplicates = true;
            toastr.options.positionClass = "toast-bottom-right";

            var config = require('./config.js');

            //https://drive.google.com/uc?export=download&id=0B1FTb0VQ85FHc1dBM2xCMm9EdE0
            var btnPlay = document.getElementById('button');
            var audio = document.getElementById('audio');
            var heading = document.getElementById("heading");  
            var streamUrl = config.streamUrl;
            var controlTipsShown = false;

            $.fn.extend({
                animateCss: function (animationName, loop) {
                    var animationEnd = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
                    if(loop){
                        $(this).addClass('animated ' + animationName);    
                    }
                    else{
                        $(this).addClass('animated ' + animationName).one(animationEnd, function() {
                            $(this).removeClass('animated ' + animationName);
                        });
                    }
                }
            });
            
            var backgroundChangeHandle = null;
            var bgImageNumber = 2;
            btnPlay.addEventListener('click', function() {
                if(audio.src !== streamUrl){        
                    audio.src = streamUrl;
                    audio.load();
                    audio.play();

                    if(!controlTipsShown){                        
                        toastr["info"]("Hit the button again to pause. But why would you even...");
                    }
                }
                else{ 
                    heading.className = '';               
                    audio.pause();
                    audio.currentTime = 0;
                    audio.src = '';

                    clearInterval(backgroundChangeHandle);
                    document.body.style.backgroundImage = '';

                    if(!controlTipsShown){                        
                        toastr["info"]("You could always hit that button again you know...");
                        controlTipsShown = true;
                    }
                }
            }, false);
                    
            audio.addEventListener('play', function(){            
                $(heading).animateCss('pulse', true); 
            });

            audio.addEventListener('playing', function(){            
                $(heading).animateCss('tada', true);  

                document.body.style.backgroundImage = 'url("images/visuals/' + bgImageNumber + '.gif")';                
                    backgroundChangeHandle = setInterval(function (){                
                        if(bgImageNumber > 14){
                            bgImageNumber = 1;
                        }
                        document.body.style.backgroundImage = 'url("images/visuals/' + bgImageNumber + '.gif")';
                        bgImageNumber += 1;
                    }, 60000);                
            });

            audio.addEventListener('error', function(){

            });
            
            toastr["info"]("Hit the button to start streaming awesomeness...");
        });    
        
    </script>

  </body>
</html>